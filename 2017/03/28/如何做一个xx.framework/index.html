<!DOCTYPE html><html lang="zh-CN"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> 如何做一个xx.framework · codeTalk</title><meta name="description" content="如何做一个xx.framework - zjcai"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="short icon" href="/favicon.png"><link rel="stylesheet" href="/css/apollo.css"><link rel="stylesheet" href="http://fonts.useso.com/css?family=Source+Sans+Pro:400,600" type="text/css"></head><body><div class="wrap"><header><a href="/" class="logo-link"><img src="/favicon.png"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">BLOG</a></li><li class="nav-list-item"><a href="/archives/" target="_self" class="nav-list-link">ARCHIVE</a></li><li class="nav-list-item"><a href="https://github.com/codeTalkCC" target="_blank" class="nav-list-link">GITHUB</a></li><li class="nav-list-item"><a href="/selfAbout.html" target="_self" class="nav-list-link">ABOUT</a></li></ul></header><section class="container"><div class="post"><article class="post-block"><h1 class="post-title">如何做一个xx.framework</h1><div class="post-info">2017年3月28日</div><div class="post-content"><h4 id="你所需要了解的基础知识"><a href="#你所需要了解的基础知识" class="headerlink" title="你所需要了解的基础知识"></a>你所需要了解的基础知识</h4><p>一、什么是库？</p>
<p>库是共享程序代码的方式，一般分为静态库和动态库。</p>
<p>二、静态库与动态库的区别？</p>
<p>静态库：链接时完整地拷贝至可执行文件中，被多次使用就有多份冗余拷贝。</p>
<p>动态库：链接时不复制，程序运行时由系统动态加载到内存，供程序调用，系统只加载一次，多个程序共用，节省内存。</p>
<p>三、iOS里静态库形式？</p>
<p>.a和.framework</p>
<p>四、iOS里动态库形式？</p>
<p>.dylib/.tbd和.framework</p>
<p>五、framework为什么既是静态库又是动态库？</p>
<p>其实Framework既可以是静态库也可以是动态库，这取决于编译成的Mach-O（就是那个二进制文件）是动态库还是静态库，Framework本质上并不是一个库，它是苹果为了方便开发者提供了一种库的打包方式，Framework会将Mach-O文件、头文件和资源包全都包含进来，不需要你再手动整理，我们也可以通过Xcode来制作framework动态库使用。<br>所以总结： Framework是库的打包形式，既可以是动态库也是静态库。<br>一般情况下，系统的.framework是动态库，我们自己建立的.framework是静态库，我们虽然也可以自己尝试建立动态库,但是上架的话不被允许的，除非是苹果自己的动态库才能被多个应用复用，个人开发的动态库还是算了吧</p>
<p>六、a与.framework有什么区别？</p>
<p>.a是一个纯二进制文件，.framework中除了有二进制文件之外还有资源文件。</p>
<p>.a文件不能直接使用，至少要有.h文件配合，.framework文件可以直接使用。</p>
<p>.a + .h + sourceFile = .framework。</p>
<p>建议用.framework.</p>
<p>七、为什么要使用静态库？</p>
<p>方便共享代码，便于合理使用。</p>
<p>实现iOS程序的模块化。可以把固定的业务模块化成静态库。</p>
<p>和别人分享你的代码库，但不想让别人看到你代码的实现。</p>
<p>开发第三方sdk的需要。</p>
<p>八、制作静态库时的几点注意：</p>
<p>1 注意理解：无论是.a静态库还.framework静态库，我们需要的都是二进制文件+.h+其它资源文件的形式，不同的是，.a本身就是二进制文件，需要我们自己配上.h和其它文件才能使用，而.framework本身已经包含了.h和其它文件，可以直接使用。</p>
<p>2 图片资源的处理：两种静态库，一般都是把图片文件单独的放在一个.bundle文件中，一般.bundle的名字和.a或.framework的名字相同。.bundle文件很好弄，新建一个文件夹，把它改名为.bundle就可以了，右键，显示包内容可以向其中添加图片资源。</p>
<p>3 category是我们实际开发项目中经常用到的，把category打成静态库是没有问题的，但是在用这个静态库的工程中，调用category中的方法时会有找不到该方法的运行时错误（selector not recognized），解决办法是：在使用静态库的工程中配置other linker flags的值为-ObjC。</p>
<p>4 如果一个静态库很复杂，需要暴露的.h比较多的话，就可以在静态库的内部创建一个.h文件（一般这个.h文件的名字和静态库的名字相同,系统自动帮我们创建好了），然后把所有需要暴露出来的.h文件都集中放在这个.h文件中，而那些原本需要暴露的.h都不需要再暴露了，只需要把.h暴露出来就可以了。</p>
<h4 id="实战演练"><a href="#实战演练" class="headerlink" title="实战演练"></a>实战演练</h4><p>######1.新建工程</p>
<p><img src="http://i2.muimg.com/567571/c40c11417c09daf8.jpg" alt=""></p>
<p>选择第一个，第二个CoCoa Touch Static Library是创建静态库的，Cocoa Touch Framework是动态静态都可以，这取决于下图中的设置，你可以选择静态的还是动态的<br><img src="http://i2.muimg.com/567571/84a9a0b112e44151.jpg" alt="选择库的类型"></p>
<p>######2.添加代码文件<br><img src="http://i4.buimg.com/567571/847693e2a5e2cbbf.jpg" alt=""></p>
<p>######3.选择你要公开的文件<br><img src="http://i4.buimg.com/567571/4a1da8a2baf2e742.jpg" alt=""></p>
<p>######4.framework的打包<br>这里我要说明一下，如果你直接运行的话，项目下的Products下会有个framework，这个framework取决于你运行环境，模拟器运行的只能在模拟器上跑，真机运行的只能在真机上跑。如果你真机上运行生成的sdk放到模拟器上，会报类似的错误<br><img src="http://i1.piimg.com/567571/ce4dbcabdf313981.jpg" alt=""></p>
<p><strong>怎样才能制作出通用的sdk呢？</strong></p>
<p>目前有两种方式，第一种是分别在两种环境下运行生成各自的framework，通过命令行的方式合成一个通用的framework，这种方式我觉得太繁琐，我不做介绍了。<br>我来讲解下第二种<br>首先添加一个target<br><img src="http://i4.buimg.com/567571/f477cd9f079128c9.png" alt=""><br><img src="http://i2.muimg.com/567571/a824447b7dd9e8db.jpg" alt=""><br>然后添加一个shell脚本<br><img src="http://i4.buimg.com/567571/e602dfebb2ba737b.png" alt=""></p>
<p>里面填入内容：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"># Sets the target folders and the final framework product.</span><br><span class="line">FMK_NAME=$&#123;PROJECT_NAME&#125;</span><br><span class="line"></span><br><span class="line"># Install dir will be the final output to the framework.</span><br><span class="line"># The following line create it in the root folder of the current project.</span><br><span class="line">INSTALL_DIR=$&#123;SRCROOT&#125;/Products/$&#123;FMK_NAME&#125;.framework</span><br><span class="line"></span><br><span class="line"># Working dir will be deleted after the framework creation.</span><br><span class="line">WRK_DIR=build</span><br><span class="line">DEVICE_DIR=$&#123;WRK_DIR&#125;/Release-iphoneos/$&#123;FMK_NAME&#125;.framework</span><br><span class="line">SIMULATOR_DIR=$&#123;WRK_DIR&#125;/Release-iphonesimulator/$&#123;FMK_NAME&#125;.framework</span><br><span class="line"></span><br><span class="line"># -configuration $&#123;CONFIGURATION&#125;</span><br><span class="line"># Clean and Building both architectures.</span><br><span class="line">xcodebuild -configuration &quot;Release&quot; -target &quot;$&#123;FMK_NAME&#125;&quot; -sdk iphoneos clean build</span><br><span class="line">xcodebuild -configuration &quot;Release&quot; -target &quot;$&#123;FMK_NAME&#125;&quot; -sdk iphonesimulator clean build</span><br><span class="line"></span><br><span class="line"># Cleaning the oldest.</span><br><span class="line">if [ -d &quot;$&#123;INSTALL_DIR&#125;&quot; ]</span><br><span class="line">then</span><br><span class="line">rm -rf &quot;$&#123;INSTALL_DIR&#125;&quot;</span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line">mkdir -p &quot;$&#123;INSTALL_DIR&#125;&quot;</span><br><span class="line"></span><br><span class="line">cp -R &quot;$&#123;DEVICE_DIR&#125;/&quot; &quot;$&#123;INSTALL_DIR&#125;/&quot;</span><br><span class="line"></span><br><span class="line"># Uses the Lipo Tool to merge both binary files (i386 + armv6/armv7) into one Universal final product.</span><br><span class="line">lipo -create &quot;$&#123;DEVICE_DIR&#125;/$&#123;FMK_NAME&#125;&quot; &quot;$&#123;SIMULATOR_DIR&#125;/$&#123;FMK_NAME&#125;&quot; -output &quot;$&#123;INSTALL_DIR&#125;/$&#123;FMK_NAME&#125;&quot;</span><br><span class="line"></span><br><span class="line">rm -r &quot;$&#123;WRK_DIR&#125;&quot;</span><br><span class="line">open &quot;$&#123;INSTALL_DIR&#125;&quot;</span><br></pre></td></tr></table></figure>
<p>然后选择这个新建的target运行就好了<br><img src="http://i1.piimg.com/567571/593f2756606aa707.jpg" alt=""><br>会自动生成一个framework，然后主动弹出来<br><img src="http://i1.piimg.com/567571/d5f4fa474af5f719.jpg" alt=""><br>尽情的使用它吧，以下是我的测试结果，就打印了一点东西<br><img src="http://i1.piimg.com/567571/b0ac56a4f7fb3165.jpg" alt=""></p>
<p>######一些注意事项,如下图所示<br><img src="http://i1.piimg.com/567571/794d3c2a5fae89e5.jpg" alt=""></p>
<p>Build Active Architecture Only?的意思是只编译当前的运行设备所需的framework吗？我选择了debug的时候是的，release的时候为否，毕竟打包出去的framework要支持各种设备型号，调试的时候只编译一个就行了</p>
<p>######参考资料<br><a href="http://www.jianshu.com/p/87dbf57cfe4a" target="_blank" rel="external">iOS封装功能生成 .framework</a><br><a href="http://www.jianshu.com/p/155a3cfb765e" target="_blank" rel="external">iOS静态库SDK制作（包含第三方静态库）</a><br><a href="https://realm.io/cn/news/altconf-conrad-kramer-writing-iOS-sdk/" target="_blank" rel="external">如何编写一个（不）受欢迎的 iOS SDK</a></p>
</div></article></div></section><footer><div class="paginator"><a href="/2017/03/25/极光推送集成小计/" class="next">NEXT</a></div><div class="copyright"><p>© 2015 - 2017 <a href="http://yoursite.com">zjcai</a>, unless otherwise noted.</p></div></footer></div><script async src="//cdn.bootcss.com/mathjax/2.6.1/MathJax.js?config=TeX-MML-AM_CHTML"></script><script>(function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;e=o.createElement(i);r=o.getElementsByTagName(i)[0];e.src='//www.google-analytics.com/analytics.js';r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));ga('create',"UA-65933410-1",'auto');ga('send','pageview');</script></body></html>